<!DOCTYPE html>

<html>
  <head>
    <title>Analog Clock Options</title>
    <style>
      canvas { display: block; }
      body { font: 13px "helvetica neue",arial,sans-serif; margin: auto; width: 320px; background: #f5f5f5;}
      
      .box, .ibox { padding: 4px; margin: 4px; }
      
      .box { border: solid #ddd 1px; background: #eee; box-shadow: 0 0 4px #ddd; border-radius: 4px;}
      .box .box { background: #e5e5e5; position: relative;}
      
      .left { float: left; }
      .right { float: right; }
      .brk { clear: both; }
      
      .toggle { display: none; }
      
      h1, h2, h3, h4 { margin: 0; }
      
      input { right: 4px; position: absolute;}
      label { line-height: 21px; }
    </style>
  </head>
  <body>
    <div class="box left" style="background: white">
      <canvas width="128" height="128" id="clock"></canvas>
    </div>
    
    <div class="ibox" style="text-align: center; ">
      <h1>Analog Clock</h1>
      <p>version 1.0</p>
      
      <h2>Preferences</h2>
      
      <p>Click on the boxes below to access the properties.</p>
    </div>
    
    <div class="box brk">
      <h2>Clock</h2><div  class="toggle">
        <input title="face color" type="color" id="fcolor"/>
        <input title="background color" type="color" id="bgcolor"/>
        <input title="border color" type="color" id="bocolor"/>
      </div>
    </div>
      
    <div class="box">
      <h2>Major scale</h2><div class="toggle">
        <input title="color" type="color" id="macolor"/>
        <input title="margin" type="range" id="madist" min="0" max="60"/>
        <input title="width" type="range" id="mawidth" min="1" max="60"/>
        <input title="length" type="range" id="malength" min="1" max="60"/>
      </div>
    </div>
    
    <div class="box"/>
      <h2>Minor scale</h2><div class="toggle">
        <input title="color" type="color" id="micolor"/>
        <input title="margin" type="range" id="midist" min="0" max="60"/>
        <input title="width" type="range" id="miwidth" min="1" max="60"/>
        <input title="length" type="range" id="milength" min="1" max="60"/>
      </div>
    </div>
    
    <div class="box"/>
      <h2>Hour hand</h2><div class="toggle">
        <input title="color" type="color" id="hcolor"/>
        <input title="width" type="range" id="hwidth" min="1" max="60"/>
        <input title="head length" type="range" id="hhlength" min="0" max="60"/>
        <input title="tail length" type="range" id="htlength" min="0" max="60"/>
      </div>
    </div>
    
    <div class="box">
      <h2>Minute hand</h2><div class="toggle">
        <input title="color" type="color" id="mcolor"/>
        <input title="width" type="range" id="mwidth" min="1" max="60"/>
        <input title="head length" type="range" id="mhlength" min="0" max="60"/>
        <input title="tail length" type="range" id="mtlength" min="0" max="60"/>
      </div>
    </div>
    
    <div class="box">
      <h2>Second hand</h2><div class="toggle">
        <input title="color" type="color" id="scolor"/>
        <input title="width" type="range" id="swidth" min="1" max="60"/>
        <input title="head length" type="range" id="shlength" min="0" max="60"/>
        <input title="tail length" type="range" id="stlength" min="0" max="60"/>
      </div>
    </div>
    
    <div class="box">
      <h2>Other</h2><div class="toggle">
        <input title="export preferences" type="button" id="export" value="export"/>
        <input title="reset settings" type="button" id="reset" value="reset"/> <div class="brk"></div>
      </div>
    </div>
    
    <div style="text-align: center"><p>made by lonedev</p></div>
    
    <script type="text/javascript" src="clock.js"/>
    <script type="text/javascript">
      // set values of the controls to those in preferences
      for(var k in pref) {
        var e = document.getElementById(k);
        if(e) {
          e.value = pref[k];
        }
      }
      
      
      var inputs = document.getElementsByTagName("input");
      
      // decorate inputs
      for(var i = 0; i < inputs.length; i++) {
        if(inputs[i].title) {
          var box = document.createElement("div");
          box.className = "box";
          var label = document.createElement("label");
          label.innerText = inputs[i].title + ":";
          box.appendChild(label);
          
          inputs[i].parentNode.insertBefore(box, inputs[i]);
          box.appendChild(inputs[i]);
        }
      }
      
      // set 'onchange' callbacks on all the input elements
      for(var i = 0; i < inputs.length; i++) {
        if(!inputs[i].id) continue;
        inputs[i].onchange = (function(id) {
          return function() {
            widget.preferences[id] = this.value; update(); drawClock(canvas, 128, 128); opera.extension.postMessage({what: "update"});
          }
        })(inputs[i].id);
      }
      
      // set hiding
      var hiders = document.querySelectorAll("h2");
      for(var i = 0; i < hiders.length; i++) {
        hiders[i].onmousedown = function() {
          var next = this.nextSibling;
          if(next != null) {
            if(next.style.display == "none") next.style.display = "block";
            else next.style.display = "none";
          }
          return false;
        }
      }
      
      document.querySelector("#export").onclick = function() {
        window.open("data:text/plain," + encodeURIComponent(JSON.stringify(widget.preferences, null, " ")), "Analog Clock preferences");
      }
      
      document.querySelector("#reset").onclick = function() {
        if(confirm("Are you sure you want to revert settings to their default values?")) {
          for(key in prefd) {
            if(widget.preferences[key]) widget.preferences[key] = prefd[key];
          }
          update(); opera.extension.postMessage({what: "update"});
        }
      }
      
      // set interval for the canvas
      var canvas = document.querySelector("#clock");
    
      window.setInterval(function() {
        drawClock(canvas, 128, 128);
      }, 500);
    </script>
  </body>
</html>

